---
title: "Mini-Project 2"
author: "Dardalie Brooks and Janell Lin"
date: "March 16,2018"
output: html_document
---


```{r}
library(tidyverse)
library(mosaic)
library(magrittr)
library(RColorBrewer)
library(ggthemes)
extrafont::loadfonts(device="win")
```


## Loading the data

This project is so interesting and relevant to my life!

```{r, include=FALSE}
#Loads data
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")


#Adds file to enviornment
load(file = "house_elections.rda")
load(file="candidates.rda")
load(file="committees.rda")
load(file="contributions.rda")
```


```{r}
library(tidyverse)
library (ggplot2)
elections_1 <- house_elections %>% 
                  select(fec_id,state,incumbent,candidate_name,party,primary_votes,ge_winner)

names(elections_1)[names(elections_1) == 'state'] <- 'STATE'


contr <- contributions %>% 
                  select(state,name,transaction_amt,cand_id,transaction_type,state)%>% 
                  filter(transaction_type%in%c("24A","24E","24N","24F")) %>% 
                  mutate(Cand_Funding=if_else(transaction_type%in%c("24E","24F"),"FOR","AGAINST"))


names(elections_1)[names(elections_1) == 'fec_id'] <- 'cand_id'

contr_incum <-contr  %>%
  inner_join(elections_1, by = "cand_id")%>% 
    group_by(cand_id,Cand_Funding,candidate_name,party,cand_id,ge_winner,incumbent,STATE) %>%
  summarise(num = n(),
              totalDonation = sum(transaction_amt))%>%
  spread (key=Cand_Funding, value=totalDonation)


```



```{r}
MA<-contr_incum %>%
  filter(STATE== "MA")%>%
  select(candidate_name,cand_id,party,cand_id,ge_winner,incumbent,STATE,FOR,AGAINST,num)
# looks @ MA data ONLY

##### Money FOR candidate

ggplot(data=MA,aes(x=candidate_name,y=FOR, fill=incumbent,ifelse(color==ge_winner,"W","N")))+
  geom_bar(stat="identity")+
  theme_minimal()+
  theme(axis.text=element_text(size=14,face="bold")) 


##### Money AGAINST candidate


a <- ifelse(contr_incum$ge_winner=="W", "red", "blue")

ggplot(data=MA,aes(x=candidate_name,y=AGAINST, fill=incumbent))+
  geom_bar(stat="identity")+
  labs(title ="MA Candidates", 
       subtitle="Contributions Against Candidates",
       caption ="FEC")+
  scale_y_continuous("Contributions in USD (Million)", 
                     limits = c(0,6000000),
                     breaks=c(0.00,1000000, 2000000,3000000, 4000000, 5000000, 60000000),
                     labels= c("0","1","2", "3", "4","5", "6"))+                     
  scale_x_discrete("Candidate Name")+
  geom_bar(stat="identity")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, color=a),
        panel.grid.major = element_blank())


```




Function for plotting graphs of 50 states
```{r}
basic_plot <- function(STATE_arg) {
  contr_incum <- contr_incum %>%
    filter(STATE == STATE_arg)
#a <- ifelse(contr_incum$ge_winner=="W", "red", "blue")
ggplot(data=contr_incum,aes(x=candidate_name,y=AGAINST, fill=incumbent))+
  ggtitle(STATE_arg, "Contributions Against Candidates")+
  scale_y_continuous("Contributions in USD (Million)", 
                     limits = c(0,6000000),
                     breaks=c(0.00,1000000, 2000000,3000000, 4000000, 5000000, 60000000),
                     labels= c("0","1","2", "3", "4","5", "6")) +                     
  scale_x_discrete("Candidate Name")+
  geom_bar(stat="identity")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, color=a))
}

basic_plot(STATE_arg = "NY")


```






```{r}
types_con <- contributions %>%     
          group_by(transaction_type) %>% 
          summarise(N=n())
#gives amount of unique transaction types

#rapply(contributions,function(x)length(unique(x))) 
```


##### Transaction Type Key:
24A -> Independent expenditure opposing election of candidate  ####AGAINST 
24E -> Independent expenditure advocating election of candidate   #####FOR
24F -> Communication cost for candidate (only for Form 7 filer)   #######FOR
24N -> Communication cost against candidate (only for Form 7 filer)   ####AGAINST 


24C -> Coordinated party expenditure
24K-> Contribution made to nonaffiliated committe
24R -> Election recount disbursement
24Z -> In-kind contribution made to registered filer   #FOR   **non-monetary

